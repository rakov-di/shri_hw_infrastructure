> Задание к дедлайну готово не полностью (см. [что сделано](#about) и [TODO](#todo)). Точно буду заниматься им в ближайшие 2 дня (возможно, 3). Если есть возможность проверить задание чуть позже - оно будет сделано чуть лучше.

## Содержание  <a name = "content_table"></a>

- [Описание домашки по инфраструктуре](#about)
- [Начало работы](#getting_started)
- [Структура файлов](#file_tree)
- [Возможные проблемы](#problems)
- [TODO](#todo)

## Описание домашки по NodeJS <a name = "about"></a>

Версия Node JS - 11.6.0

Текущая ситуация 

Билд-сервер умеет:
 - подниматься (кстати, полезный навык, мне вот не всегда удается)
 - запрашивать из api БД текущие настройки репозиторий и список билдов (при ошибках -  повторять запросы)
 - ожидать билд-агентов на ручке `/notify`
 - регистрировать билд-агент и отправлять ему задание на ручку `/build` добавлять инфу об этом в БД через ручку `/start`
 - принимать результата работы от билд-агента, назначать агенту следующий билд, обновлять инфу в БД о билде через ручку и `/finish`

Билд-агент умеет: 
 - подниматься 
 - стучаться к билд-серверу на ручку билд-сервера `/notify` (при ошибках - повторять запросы)
 - получать билд на свою ручку `/build`
 - клонировать (или пулить если уже склонирован) репозиторий, делать билд
 - отправлять результаты билда на ручку билд-сервера `/notify-build-result` (при ошибках - повторять запросы)

Вернуться [К содержанию](#content_table)

## Начало работы <a name = "getting_started"></a>

Для запуска приложения необходимо:
- В папке [build-server](build-server) создать файл конфигурации `config.json` (содержимое - по аналогии с файлом [config.example.json](build-server/config.example.json)).

- Запустить билд-сервер:
```bash
cd build-server && npm ci && npm start
```

- Запустить билд-агент:
```bash
cd build-agent && npm ci && npm start
```

Вернуться [К содержанию](#content_table)

## Структура файлов <a name = "file_tree"></a>

Структура билд-сервера и билд-агента похожи.
- build-server
    - app.js - точка всхода
    - config.js - основные настройки
    - build-server/router - маршрутизация зарпросов, приходящих на торчащие наружу ручки
    - build-server/api - апи для обращения наружу (к апи БД и ручкам билд-агента)
    - build-server/controllers - обработчики обращений к своим и сторонним апи
    - build-server/utils - вспомогательные утилиты
    - build-server/storage - хранилище информации о билдах и агентах
- build-agent
    - app.js - точка всхода
    - config.js - основные настройки
    - build-server/router - маршрутизация зарпросов, приходящих на торчащие наружу ручки
    - build-server/api - апи для обращения наружу (к ручкам билд-сервера))
    - build-server/controllers - обработчики обращений к своим и сторонним апи
    - build-server/utils - вспомогательные утилиты

Вернуться [К содержанию](#content_table)

## Возможные проблемы <a name = "problems"></a>

Убедитесь, что используемые билд-сервером и билд-агентами порты (8000, 9000, 9001 и т.д.) не заняты другими программами.

## TODO <a name = "todo"></a>
- Научить билд-сервер
    - обрабатывать ситуации, когда билд-агент прекратил работать между/во время сборки
    - обновлять билд-лист (либо просто периодично, либо только при завершении задач в текущем билд листе) 
- Создать еще одного билд-агента, проверить насколько эффективно билд-сервер распределят задачи между билд агентами
- Перенести хранилище билд-сервера из оперативки хотя бы в лог-файлы, чтобы после падения/восстановления билд-сервера он не терял инфу о билд-агентах и сборках
- подготовить докер-образы
    
Вернуться [К содержанию](#content_table)
